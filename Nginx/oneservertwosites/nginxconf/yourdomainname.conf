server {
  listen      <ipaddress>:80;
  server_name <domainname>.org www.<domainname>.org <subdomainname>.<domainname>.edu; 
  rewrite     ^ https://www.<domainname>.org$request_uri? permanent;
}

server {
  listen      <ipaddress>:443 ssl http2;
  server_name <subdomainname>.<domainname>.<tld> ;
  rewrite     ^ https://www.<domainname>$request_uri? permanent;

  add_header Strict-Transport-Security "max-age=31536000; includeSubdomains";
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Referrer-Policy "no-referrer-when-downgrade" always;
  add_header X-Xss-Protection "1; mode=block" always;
  ssl_protocols  TLSv1.2 TLSv1.3;
  ssl_stapling on;
  ssl_stapling_verify on;
  resolver 8.8.8.8 8.8.4.4 valid=300s;
  resolver_timeout 5s;
  ssl_session_timeout 1d;
  ssl_session_cache shared:MozSSL:50m;

  ssl_ciphers <ssl_ciphers>;


  ssl_certificate /etc/pki/tls/certs/<filename>.pem
  ssl_certificate_key /etc/pki/tls/private/<filename>.key;



}

server {
  listen      443 ssl;
  server_name <domainname>;
  rewrite     ^ https://www.<domainname>$request_uri? permanent;

  client_max_body_size 50m;
  ssl_stapling on;
  ssl_stapling_verify on;
  #ssl_trusted_certificate  /etc/pki/tls/certs/InCommon.pem;
  resolver 8.8.8.8 8.8.4.4 valid=300s; # use Google DNS and cache results for 300s
  resolver_timeout 5s;
  ssl_session_timeout 1d;
  ssl_session_cache shared:MozSSL:50m;

  add_header Strict-Transport-Security "max-age=31536000; includeSubdomains";
  add_header Cache-Control "max-age=900; includeSubdomains";
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Referrer-Policy "no-referrer-when-downgrade" always;
  add_header X-Xss-Protection "1; mode=block" always;
  ssl_protocols  TLSv1.2 TLSv1.3;

  ssl_prefer_server_ciphers on;

  ssl_ciphers <ssl_ciphers>;


  ssl_certificate /etc/letsencrypt/live/www.<domainname>.org/<filename>.pem;
  ssl_certificate_key /etc/letsencrypt/live/www.<domainname>.org/<filename>.pem;

  ssl_dhparam /etc/pki/tls/dhparams.pem;
}

server {
  listen 443 ssl;
  server_name www.<domainname>.org;
  add_header Strict-Transport-Security "max-age=31536000; includeSubdomains";
  add_header Cache-Control "max-age=900; includeSubdomains";
  client_max_body_size 50m;
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Referrer-Policy "no-referrer-when-downgrade" always;
  add_header X-Xss-Protection "1; mode=block" always;
  ssl_protocols  TLSv1.2 TLSv1.3;

  ssl_prefer_server_ciphers on;

  ssl_ciphers <ssl_ciphers>;

  ssl_certificate /etc/letsencrypt/live/www.<domainname>.org/<filename>.pem;
  ssl_certificate_key /etc/letsencrypt/live/www.<domainname>org/<filename>.pem;


  ssl_stapling on;
  ssl_stapling_verify on;
  resolver 8.8.8.8 8.8.4.4 valid=300s; # use Google DNS and cache results for 300s
  resolver_timeout 5s;
  ssl_session_timeout 1d;


  ssl_dhparam /etc/pki/tls/dhparams.pem;

  location /nginx_status {
    # Turn on stats
    stub_status on;
    access_log   off;
    deny all;
   }

  location ~ cron\.php {
    proxy_pass http://<VirtualHostIPwhereyouarepointingto>:<port>;
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header X-Forwarded-Port 443;
    proxy_set_header Host $host;

    proxy_ignore_client_abort on;

    proxy_connect_timeout    900;
    proxy_send_timeout       900;
    proxy_read_timeout       900;
  }

  location / {

    if ($args ~ q=user) {
      return 403;
    }

    proxy_pass http://<VirtualHostIPwhereyouarepointingto>:<port>;
        proxy_set_header X-Real-IP  $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
        proxy_set_header X-Forwarded-Port 443;
    proxy_set_header Host $host;

    ## Added 20150330 (default is 60s)
    proxy_connect_timeout    600;
    proxy_send_timeout       600;
    proxy_read_timeout       600;
  }
}